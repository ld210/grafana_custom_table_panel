define(["lodash","@grafana/ui","app/core/utils/flatten","app/core/time_series2","app/core/table_model","moment","app/core/utils/kbn","jquery","app/plugins/sdk","app/core/config"],function(t,e,n,r,a,l,o,s,i,u){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=11)}([function(e,n){e.exports=t},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.transformDataToTable=e.transformers=void 0,e.mergeTablesIntoModel=p;var r=s(n(0)),a=s(n(3)),l=s(n(4)),o=s(n(5));function s(t){return t&&t.__esModule?t:{default:t}}var i={};function u(t,e,n){for(var r=!1,a=0;a<t.length;a++)if(void 0!==e[a]&&void 0!==n[a]){if(e[a]!==n[a])return!1}else void 0!==e[a]&&void 0!==n[a]||(r=!0);return r}function p(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var a=t||new o.default;if(1===arguments.length)return a;if(2===arguments.length)return a.columns=e[0].hasOwnProperty("columns")?e[0].columns.slice():[],a.rows=e[0].hasOwnProperty("rows")?e[0].rows.slice():[],a;var l={},s=e.slice().reduce(function(t,e){return e.columns.forEach(function(e){var n=e.text;void 0===l[n]&&(l[n]=t.length,t.push(e))}),t},[]),i=e.map(function(t){return t.columns.map(function(t){return l[t.text]})}),p=e.reduce(function(t,e,n){var r=i[n];return e.rows.forEach(function(e){var n=[];r.forEach(function(t,r){n[t]=e[r]}),t.push(n)}),t},[]),c={},d=p.reduce(function(t,e,n){if(!c[n]){for(var a=n+1;a<p.length;){var l=r.default.findIndex(p,function(t){return u(s,e,t)},a);if(!(l>-1))break;for(var o=p[l],i=0;i<s.length;i++)void 0===e[i]&&void 0!==o[i]&&(e[i]=o[i]);c[l]=o,a=l+1}t.push(e)}return t},[]);return a.columns=s,a.rows=d,a}i.timeseries_to_rows={description:"Time series to rows",getColumns:function(){return[]},transform:function(t,e,n){n.columns=[{text:"Time",type:"date"},{text:"Metric"},{text:"Value"}];for(var r=0;r<t.length;r++)for(var a=t[r],l=0;l<a.datapoints.length;l++){var o=a.datapoints[l];n.rows.push([o[1],a.target,o[0]])}}},i.timeseries_to_columns={description:"Time series to columns",getColumns:function(){return[]},transform:function(t,e,n){n.columns.push({text:"Time",type:"date"});for(var r={},a=0;a<t.length;a++){var l=t[a];n.columns.push({text:l.target});for(var o=0;o<l.datapoints.length;o++){var s=l.datapoints[o],i=s[1].toString();r[i]?r[i][a]=s[0]:(r[i]={time:s[1]},r[i][a]=s[0])}}for(var u in r){var p=r[u],c=[p.time];for(a=0;a<t.length;a++){var d=p[a];c.push(d)}n.rows.push(c)}}},i.timeseries_aggregations={description:"Time series aggregations",getColumns:function(){return[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Total",value:"total"},{text:"Current",value:"current"},{text:"Count",value:"count"}]},transform:function(t,e,n){var r,a;for(n.columns.push({text:"Metric"}),r=0;r<e.columns.length;r++)n.columns.push({text:e.columns[r].text});for(r=0;r<t.length;r++){var o=new l.default({datapoints:t[r].datapoints,alias:t[r].target});o.getFlotPairs("connected");var s=[o.alias];for(a=0;a<e.columns.length;a++)s.push(o.stats[e.columns[a].value]);n.rows.push(s)}}},i.annotations={description:"Annotations",getColumns:function(){return[]},transform:function(t,e,n){if(n.columns.push({text:"Time",type:"date"}),n.columns.push({text:"Title"}),n.columns.push({text:"Text"}),n.columns.push({text:"Tags"}),t&&t.annotations&&0!==t.annotations.length)for(var r=0;r<t.annotations.length;r++){var a=t.annotations[r];n.rows.push([a.time,a.title,a.text,a.tags])}}},i.table={description:"Table",getColumns:function(t){if(!t||0===t.length)return[];if(1===t.length)return t[0].columns.slice();var e={};return t.reduce(function(t,n){return n.columns.forEach(function(n){var r=n.text;void 0===e[r]&&(e[r]=t.length,t.push(n))}),t},[])},transform:function(t,e,n){if(t&&0!==t.length){var a=r.default.findIndex(t,function(t){return"table"!==t.type});if(a>-1)throw{message:"Result of query #"+String.fromCharCode(65+a)+" is not in table format, try using another transform."};p.apply(void 0,[n].concat(t))}}},i.json={description:"JSON Data",getColumns:function(t){if(!t||0===t.length)return[];for(var e={},n=0;n<t.length;n++){var l=t[n];if("docs"===l.type)for(var o=Math.min(l.datapoints.length,100),s=0;s<o;s++){var i=l.datapoints[s],u=(0,a.default)(i,null);for(var p in u)e[p]=!0}}return r.default.map(e,function(t,e){return{text:e,value:e}})},transform:function(t,e,n){for(var l,o,s,i=0,u=e.columns;i<u.length;i++){var p={text:u[i].text};t.length>0&&t[0].filterable&&(p.filterable=!0),n.columns.push(p)}for(0===n.columns.length&&n.columns.push({text:"JSON"}),l=0;l<t.length;l++){var c=t[l];for(o=0;o<c.datapoints.length;o++){var d=c.datapoints[o],f=[];if(r.default.isObject(d)&&e.columns.length>0){var h=(0,a.default)(d,null);for(s=0;s<e.columns.length;s++)f.push(h[e.columns[s].value])}else f.push(JSON.stringify(d));n.rows.push(f)}}}},e.transformers=i,e.transformDataToTable=function(t,e){var n=new o.default;if(!t||0===t.length)return n;var r=i[e.transform];if(!r)throw{message:"Transformer "+e.transform+" not found"};return r.transform(t,e,n),n}},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e){t.exports=r},function(t,e){t.exports=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TableRenderer=void 0;var r=s(n(0)),a=s(n(7)),l=s(n(8)),o=n(2);function s(t){return t&&t.__esModule?t:{default:t}}var i=function(){function t(t,e,n,r,a,l){this.panel=t,this.table=e,this.isUtc=n,this.sanitize=r,this.templateSrv=a,this.theme=l,this.initColumns()}return t.prototype.setTable=function(t){this.table=t,this.initColumns()},t.prototype.initColumns=function(){this.formatters=[],this.colorState={};for(var t=0;t<this.table.columns.length;t++){var e=this.table.columns[t];e.title=e.text;for(var n=0;n<this.panel.styles.length;n++){var r=this.panel.styles[n],a=l.default.stringToJsRegex(r.pattern);if(e.text.match(a)){e.style=r,r.alias&&(e.title=e.text.replace(a,r.alias));break}}this.formatters[t]=this.createColumnFormatter(e)}},t.prototype.getColorForValue=function(t,e){if(!e.thresholds)return null;for(var n=e.thresholds.length;n>0;n--)if(t>=e.thresholds[n-1])return(0,o.getColorFromHexRgbOrName)(e.colors[n],this.theme);return(0,o.getColorFromHexRgbOrName)(e.colors[0],this.theme)},t.prototype.defaultCellFormatter=function(t,e){return null==t||void 0===t?"":(r.default.isArray(t)&&(t=t.join(", ")),e&&e.sanitize?this.sanitize(t):r.default.escape(t))},t.prototype.createColumnFormatter=function(t){var e=this;if(!t.style)return this.defaultCellFormatter;if("hidden"===t.style.type)return function(t){};if("date"===t.style.type)return function(n){if(null==n)return"-";r.default.isArray(n)&&(n=n[0]),r.default.isString(n)&&!isNaN(Number(n))&&n.length>12&&(n=parseInt(n,10));var l=(0,a.default)(n);return e.isUtc&&(l=l.utc()),t.style.rawValue=n,l.format(t.style.dateFormat)};if("string"===t.style.type)return function(n){r.default.isArray(n)&&(n=n.join(", "));var a=t.style.mappingType||0;if(1===a&&t.style.valueMaps)for(var l=0;l<t.style.valueMaps.length;l++){var o=t.style.valueMaps[l];if(null!==n){if(!r.default.isString(n)&&Number(o.value)===Number(n)||o.value===n)return e.setColorState(n,t.style),e.defaultCellFormatter(o.text,t.style)}else if("null"===o.value)return o.text}if(2===a&&t.style.rangeMaps)for(l=0;l<t.style.rangeMaps.length;l++)if(o=t.style.rangeMaps[l],null!==n){if(Number(o.from)<=Number(n)&&Number(o.to)>=Number(n))return e.setColorState(n,t.style),e.defaultCellFormatter(o.text,t.style)}else if("null"===o.from&&"null"===o.to)return o.text;return null==n?"-":(e.setColorState(n,t.style),e.defaultCellFormatter(n,t.style))};if("number"===t.style.type){var n=(0,o.getValueFormat)(t.unit||t.style.unit);return function(a){return t.style.rawValue=a,null==a?"-":r.default.isString(a)||r.default.isArray(a)?e.defaultCellFormatter(a,t.style):(e.setColorState(a,t.style),n(a,t.style.decimals,null))}}return function(n){return t.style.rawValue=n,e.defaultCellFormatter(n,t.style)}},t.prototype.setColorState=function(t,e){if(e.colorMode&&null!=t&&!r.default.isArray(t)){var n=Number(t);isNaN(n)||(this.colorState[e.colorMode]=this.getColorForValue(n,e))}},t.prototype.renderRowVariables=function(t){for(var e={},n=this.table.rows[t],r=0;r<n.length;r++)e["__cell_"+r]={value:n[r]};return e},t.prototype.formatColumnValue=function(t,e){return this.formatters[t]?this.formatters[t](e):e},t.prototype.renderCell=function(t,e,n,r){void 0===r&&(r=!1),n=this.formatColumnValue(t,n);var a=this.table.columns[t],l="",o="",s=[],i="";this.colorState.cell?(l=' style="background-color:'+this.colorState.cell+'"',s.push("table-panel-color-cell"),this.colorState.cell=null):this.colorState.value&&(o=' style="color:'+this.colorState.value+'"',this.colorState.value=null);var u="";if(r&&(u='<div class="table-panel-width-hack">'+this.table.columns[t].title+"</div>"),void 0===n?(l=' style="display:none;"',a.hidden=!0):a.hidden=!1,!0===a.hidden)return"";if(a.style&&a.style.preserveFormat&&s.push("table-panel-cell-pre"),a.style&&a.style.link){var p=this.renderRowVariables(e);p.__cell={value:n};var c=this.templateSrv.replace(a.style.linkUrl,p,encodeURIComponent),d=this.templateSrv.replace(a.style.linkTooltip,p),f=a.style.linkTargetBlank?"_blank":"";s.push("table-panel-cell-link"),u+='\n        <a href="'+c+'" target="'+f+'" data-link-tooltip data-original-title="'+d+'" data-placement="right"'+o+">\n          "+n+"\n        </a>\n      "}else u+=n;if(a.filterable&&(s.push("table-panel-cell-filterable"),u+='\n        <a class="table-panel-filter-link" data-link-tooltip data-original-title="Filter out value" data-placement="bottom"\n           data-row="'+e+'" data-column="'+t+'" data-operator="!=">\n          <i class="fa fa-search-minus"></i>\n        </a>\n        <a class="table-panel-filter-link" data-link-tooltip data-original-title="Filter for value" data-placement="bottom"\n           data-row="'+e+'" data-column="'+t+'" data-operator="=">\n          <i class="fa fa-search-plus"></i>\n        </a>'),s.length&&(i=' class="'+s.join(" ")+'"'),a.style&&"delta"===a.style.type){var h=Number(a.style.rawValue),m=h>0?"up":h<0?"down":void 0,v=a.style.colors,g="up"===m?v[v.length-1]:"down"===m?v[0]:"#ffffff";u=m?'\n        <div class="arrow-container" style="display:block;width:25px;height:25px;color:'+g+';font-size:20px;line-height:25px;">\n          <i class="grafana-tip fa fa-arrow-'+m+'" bs-tooltip="'+n+'" data-original-title title="'+n+'"></i>\n          <span class="bidder-tooltip">'+n+"</span>\n        </div>\n      ":"-"}return u=a.style&&"progressbar"===a.style.display?'\n      <td style="padding:0;background-color:#212124;">\n        <div style="display:block;width:'+n+";max-width:100%;height:100%;padding:5px 0;background-color:"+(g=this.getColorForValue(Number(a.style.rawValue),a.style))+'">'+n+"</div>\n      </td>":"<td"+i+l+o+">"+u+"</td>"},t.prototype.render=function(t){for(var e=this.panel.pageSize||100,n=t*e,r=Math.min(n+e,this.table.rows.length),a="",l=[],o="",s=n;s<r;s++){for(var i=this.table.rows[s],u="",p="",c=0;c<this.table.columns.length;c++)u+=this.renderCell(c,s,i[c],s===n);this.colorState.row&&(p=' style="background-color:'+this.colorState.row+'"',l.push("table-panel-color-row"),this.colorState.row=null),l.length&&(o=' class="'+l.join(" ")+'"'),a+="<tr "+o+p+">"+u+"</tr>"}return a},t.prototype.render_values=function(){for(var t=[],e=0;e<this.table.rows.length;e++){for(var n=this.table.rows[e],r=[],a=0;a<this.table.columns.length;a++)r.push(this.formatColumnValue(a,n[a]));t.push(r)}return{columns:this.table.columns,rows:t}},t}();e.TableRenderer=i},function(t,e){t.exports=l},function(t,e){t.exports=o},function(t,e,n){"use strict";o.$inject=["$q","uiSegmentSrv"],Object.defineProperty(e,"__esModule",{value:!0}),e.TablePanelEditorCtrl=void 0,e.tablePanelEditor=o;var r=function(t){return t&&t.__esModule?t:{default:t}}(n(0)),a=n(1),l=function(){function t(t,e,n){this.$q=e,this.uiSegmentSrv=n,t.editor=this,this.panelCtrl=t.ctrl,this.panel=this.panelCtrl.panel,this.transformers=a.transformers,this.fontSizes=["80%","90%","100%","110%","120%","130%","150%","160%","180%","200%","220%","250%"],this.addColumnSegment=n.newPlusButton(),this.updateTransformHints()}return t.$inject=["$scope","$q","uiSegmentSrv"],t.prototype.updateTransformHints=function(){switch(this.canSetColumns=!1,this.columnsHelpMessage="",this.panel.transform){case"timeseries_aggregations":case"json":this.canSetColumns=!0;break;case"table":this.columnsHelpMessage="Columns and their order are determined by the data query"}},t.prototype.getColumnOptions=function(){var t=this;if(!this.panelCtrl.dataRaw)return this.$q.when([]);var e=this.transformers[this.panel.transform].getColumns(this.panelCtrl.dataRaw),n=r.default.map(e,function(e){return t.uiSegmentSrv.newSegment({value:e.text})});return this.$q.when(n)},t.prototype.addColumn=function(){var t=a.transformers[this.panel.transform].getColumns(this.panelCtrl.dataRaw),e=r.default.find(t,{text:this.addColumnSegment.value});e&&(this.panel.columns.push(e),this.render());var n=this.uiSegmentSrv.newPlusButton();this.addColumnSegment.html=n.html,this.addColumnSegment.value=n.value},t.prototype.transformChanged=function(){this.panel.columns=[],"timeseries_aggregations"===this.panel.transform&&this.panel.columns.push({text:"Avg",value:"avg"}),this.updateTransformHints(),this.render()},t.prototype.render=function(){this.panelCtrl.render()},t.prototype.removeColumn=function(t){this.panel.columns=r.default.without(this.panel.columns,t),this.panelCtrl.render()},t}();function o(t,e){return{restrict:"E",scope:!0,templateUrl:"public/plugins/tradelab-bidder-table/editor.html",controller:l}}e.TablePanelEditorCtrl=l},function(t,e,n){"use strict";o.$inject=["$q","uiSegmentSrv"],Object.defineProperty(e,"__esModule",{value:!0}),e.ColumnOptionsCtrl=void 0,e.columnOptionsTab=o;var r=function(t){return t&&t.__esModule?t:{default:t}}(n(0)),a=n(2),l=function(){function t(t){var e=this;t.editor=this,this.activeStyleIndex=0,this.panelCtrl=t.ctrl,this.panel=this.panelCtrl.panel,this.unitFormats=(0,a.getValueFormats)(),this.colorModes=[{text:"Disabled",value:null},{text:"Cell",value:"cell"},{text:"Value",value:"value"},{text:"Row",value:"row"}],this.columnTypes=[{text:"Number",value:"number"},{text:"Delta",value:"delta"},{text:"String",value:"string"},{text:"Date",value:"date"},{text:"Hidden",value:"hidden"}],this.fontSizes=["80%","90%","100%","110%","120%","130%","150%","160%","180%","200%","220%","250%"],this.dateFormats=[{text:"YYYY-MM-DD HH:mm:ss",value:"YYYY-MM-DD HH:mm:ss"},{text:"YYYY-MM-DD HH:mm:ss.SSS",value:"YYYY-MM-DD HH:mm:ss.SSS"},{text:"MM/DD/YY h:mm:ss a",value:"MM/DD/YY h:mm:ss a"},{text:"MMMM D, YYYY LT",value:"MMMM D, YYYY LT"},{text:"YYYY-MM-DD",value:"YYYY-MM-DD"}],this.mappingTypes=[{text:"Value to text",value:1},{text:"Range to text",value:2}],this.getColumnNames=function(){return e.panelCtrl.table?r.default.map(e.panelCtrl.table.columns,function(t){return t.text}):[]},this.onColorChange=this.onColorChange.bind(this)}return t.$inject=["$scope"],t.prototype.render=function(){this.panelCtrl.render()},t.prototype.setUnitFormat=function(t,e){t.unit=e.value,"percentunit"===e.value&&(t.display="val"),this.panelCtrl.render()},t.prototype.addColumnStyle=function(){var t=this.panel.styles,e=t.length,n=e;e>0&&"/.*/"===t[e-1].pattern&&(n=e-1),t.splice(n,0,{unit:"short",type:"number",alias:"",decimals:2,colors:["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],colorMode:null,pattern:"",dateFormat:"YYYY-MM-DD HH:mm:ss",thresholds:[],mappingType:1}),this.activeStyleIndex=n},t.prototype.removeColumnStyle=function(t){this.panel.styles=r.default.without(this.panel.styles,t)},t.prototype.invertColorOrder=function(t){var e=this.panel.styles[t].colors,n=e[0];e[0]=e[2],e[2]=n,this.panelCtrl.render()},t.prototype.onColorChange=function(t,e){var n=this;return function(r){n.panel.styles[t].colors[e]=r,n.render()}},t.prototype.addValueMap=function(t){t.valueMaps||(t.valueMaps=[]),t.valueMaps.push({value:"",text:""}),this.panelCtrl.render()},t.prototype.removeValueMap=function(t,e){t.valueMaps.splice(e,1),this.panelCtrl.render()},t.prototype.addRangeMap=function(t){t.rangeMaps||(t.rangeMaps=[]),t.rangeMaps.push({from:"",to:"",text:""}),this.panelCtrl.render()},t.prototype.removeRangeMap=function(t,e){t.rangeMaps.splice(e,1),this.panelCtrl.render()},t}();function o(t,e){return{restrict:"E",scope:!0,templateUrl:"public/plugins/tradelab-bidder-table/column_options.html",controller:l}}e.ColumnOptionsCtrl=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PanelCtrl=e.TablePanelCtrl=void 0;var r=c(n(0)),a=c(n(12)),l=n(13),o=c(n(14)),s=n(1),i=n(9),u=n(10),p=n(6);function c(t){return t&&t.__esModule?t:{default:t}}var d=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),f=function(t){function e(e,n,a,l,o,s){var i=t.call(this,e,n)||this;return i.annotationsSrv=l,i.$sanitize=o,i.variableSrv=s,i.panelDefaults={targets:[{}],transform:"timeseries_to_columns",pageSize:null,showHeader:!0,styles:[{type:"date",pattern:"Time",alias:"Time",dateFormat:"YYYY-MM-DD HH:mm:ss"},{unit:"short",type:"number",alias:"",decimals:2,colors:["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],colorMode:null,pattern:"/.*/",thresholds:[]}],columns:[],scroll:!0,fontSize:"100%",sort:{col:0,desc:!0}},i.pageIndex=0,void 0===i.panel.styles&&(i.panel.styles=i.panel.columns,i.panel.columns=i.panel.fields,delete i.panel.columns,delete i.panel.fields),r.default.defaults(i.panel,i.panelDefaults),i.events.on("data-received",i.onDataReceived.bind(i)),i.events.on("data-error",i.onDataError.bind(i)),i.events.on("data-snapshot-load",i.onDataReceived.bind(i)),i.events.on("init-edit-mode",i.onInitEditMode.bind(i)),i.events.on("init-panel-actions",i.onInitPanelActions.bind(i)),i}return d(e,t),e.$inject=["$scope","$injector","templateSrv","annotationsSrv","$sanitize","variableSrv"],e.prototype.onInitEditMode=function(){this.addEditorTab("Options",i.tablePanelEditor,2),this.addEditorTab("Column Styles",u.columnOptionsTab,3)},e.prototype.onInitPanelActions=function(t){t.push({text:"Export CSV",click:"ctrl.exportCsv()"})},e.prototype.issueQueries=function(e){return this.pageIndex=0,"annotations"===this.panel.transform?this.annotationsSrv.getAnnotations({dashboard:this.dashboard,panel:this.panel,range:this.range}).then(function(t){return{data:t}}):t.prototype.issueQueries.call(this,e)},e.prototype.onDataError=function(t){this.dataRaw=[],this.render()},e.prototype.onDataReceived=function(t){this.dataRaw=t,this.pageIndex=0,this.dataRaw&&this.dataRaw.length&&("table"===this.dataRaw[0].type?this.panel.transform="table":"docs"===this.dataRaw[0].type?this.panel.transform="json":"table"!==this.panel.transform&&"json"!==this.panel.transform||(this.panel.transform="timeseries_to_rows")),this.render()},e.prototype.render=function(){return this.table=(0,s.transformDataToTable)(this.dataRaw,this.panel),this.table.sort(this.panel.sort),this.renderer=new p.TableRenderer(this.panel,this.table,this.dashboard.isTimezoneUtc(),this.$sanitize,this.templateSrv,o.default.theme.type),t.prototype.render.call(this,this.table)},e.prototype.toggleColumnSort=function(t,e){this.table.columns[this.panel.sort.col]&&(this.table.columns[this.panel.sort.col].sort=!1),this.panel.sort.col===e?this.panel.sort.desc?this.panel.sort.desc=!1:this.panel.sort.col=null:(this.panel.sort.col=e,this.panel.sort.desc=!0),this.render()},e.prototype.exportCsv=function(){var t=this.$scope.$new(!0);t.tableData=this.renderer.render_values(),t.panel="table",this.publishAppEvent("show-modal",{templateHtml:'<export-data-modal panel="panel" data="tableData"></export-data-modal>',scope:t,modalClass:"modal--narrow"})},e.prototype.link=function(t,e,n,r){var l,o=r.panel,s=0;function i(){var t=e.parents(".panel-content"),n=e.find(".table-panel-scroll"),i=e.find("tbody"),u=e.find(".table-panel-footer");e.css({"font-size":o.fontSize}),t.addClass("table-panel-content"),function(t){r.renderer.setTable(l),t.empty(),t.html(r.renderer.render(r.pageIndex))}(i),function(t){t.empty();var e=o.pageSize||100;if(1!==(s=Math.ceil(l.rows.length/e))){for(var n=Math.max(r.pageIndex-3,0),i=Math.min(s,n+9),u=(0,a.default)("<ul></ul>"),p=n;p<i;p++){var c=p===r.pageIndex?"active":"",d=(0,a.default)('<li><a class="table-panel-page-link pointer '+c+'">'+(p+1)+"</a></li>");u.append(d)}t.append(u)}}(u),n.css({"max-height":o.scroll?function(){var t=r.height;return s>1&&(t-=26),t-31+"px"}():""})}e.tooltip({selector:"[data-link-tooltip]"}),e.on("click",".table-panel-page-link",function(t){var e=(0,a.default)(t.currentTarget);r.pageIndex=parseInt(e.text(),10)-1,i()}),e.on("click",".table-panel-filter-link",function(t){var e=(0,a.default)(t.currentTarget).data(),n={datasource:o.datasource,key:l.columns[e.column].text,value:l.rows[e.row][e.column],operator:e.operator};r.variableSrv.setAdhocFilter(n)});var u=t.$on("$destroy",function(){e.off("click",".table-panel-page-link"),e.off("click",".table-panel-filter-link"),u()});r.events.on("render",function(t){(l=t||l)&&i(),r.renderingCompleted()})},e.templateUrl="module.html",e}(l.MetricsPanelCtrl);(0,l.loadPluginCss)({dark:"plugins/tradelab-bidder-table/bidder-panel.css",light:"plugins/tradelab-bidder-table/bidder-panel.css"}),e.TablePanelCtrl=f,e.PanelCtrl=f},function(t,e){t.exports=s},function(t,e){t.exports=i},function(t,e){t.exports=u}])});
//# sourceMappingURL=module.js.map