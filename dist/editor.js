define(["lodash","app/core/utils/flatten","app/core/time_series2","app/core/table_model"],function(t,e,n,r){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=9)}([function(e,n){e.exports=t},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.transformDataToTable=e.transformers=void 0,e.mergeTablesIntoModel=f;var r=u(n(0)),o=u(n(3)),a=u(n(4)),s=u(n(5));function u(t){return t&&t.__esModule?t:{default:t}}var i={};function l(t,e,n){for(var r=!1,o=0;o<t.length;o++)if(void 0!==e[o]&&void 0!==n[o]){if(e[o]!==n[o])return!1}else void 0!==e[o]&&void 0!==n[o]||(r=!0);return r}function f(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var o=t||new s.default;if(1===arguments.length)return o;if(2===arguments.length)return o.columns=e[0].hasOwnProperty("columns")?e[0].columns.slice():[],o.rows=e[0].hasOwnProperty("rows")?e[0].rows.slice():[],o;var a={},u=e.slice().reduce(function(t,e){return e.columns.forEach(function(e){var n=e.text;void 0===a[n]&&(a[n]=t.length,t.push(e))}),t},[]),i=e.map(function(t){return t.columns.map(function(t){return a[t.text]})}),f=e.reduce(function(t,e,n){var r=i[n];return e.rows.forEach(function(e){var n=[];r.forEach(function(t,r){n[t]=e[r]}),t.push(n)}),t},[]),c={},m=f.reduce(function(t,e,n){if(!c[n]){for(var o=n+1;o<f.length;){var a=r.default.findIndex(f,function(t){return l(u,e,t)},o);if(!(a>-1))break;for(var s=f[a],i=0;i<u.length;i++)void 0===e[i]&&void 0!==s[i]&&(e[i]=s[i]);c[a]=s,o=a+1}t.push(e)}return t},[]);return o.columns=u,o.rows=m,o}i.timeseries_to_rows={description:"Time series to rows",getColumns:function(){return[]},transform:function(t,e,n){n.columns=[{text:"Time",type:"date"},{text:"Metric"},{text:"Value"}];for(var r=0;r<t.length;r++)for(var o=t[r],a=0;a<o.datapoints.length;a++){var s=o.datapoints[a];n.rows.push([s[1],o.target,s[0]])}}},i.timeseries_to_columns={description:"Time series to columns",getColumns:function(){return[]},transform:function(t,e,n){n.columns.push({text:"Time",type:"date"});for(var r={},o=0;o<t.length;o++){var a=t[o];n.columns.push({text:a.target});for(var s=0;s<a.datapoints.length;s++){var u=a.datapoints[s],i=u[1].toString();r[i]?r[i][o]=u[0]:(r[i]={time:u[1]},r[i][o]=u[0])}}for(var l in r){var f=r[l],c=[f.time];for(o=0;o<t.length;o++){var m=f[o];c.push(m)}n.rows.push(c)}}},i.timeseries_aggregations={description:"Time series aggregations",getColumns:function(){return[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Total",value:"total"},{text:"Current",value:"current"},{text:"Count",value:"count"}]},transform:function(t,e,n){var r,o;for(n.columns.push({text:"Metric"}),r=0;r<e.columns.length;r++)n.columns.push({text:e.columns[r].text});for(r=0;r<t.length;r++){var s=new a.default({datapoints:t[r].datapoints,alias:t[r].target});s.getFlotPairs("connected");var u=[s.alias];for(o=0;o<e.columns.length;o++)u.push(s.stats[e.columns[o].value]);n.rows.push(u)}}},i.annotations={description:"Annotations",getColumns:function(){return[]},transform:function(t,e,n){if(n.columns.push({text:"Time",type:"date"}),n.columns.push({text:"Title"}),n.columns.push({text:"Text"}),n.columns.push({text:"Tags"}),t&&t.annotations&&0!==t.annotations.length)for(var r=0;r<t.annotations.length;r++){var o=t.annotations[r];n.rows.push([o.time,o.title,o.text,o.tags])}}},i.table={description:"Table",getColumns:function(t){if(!t||0===t.length)return[];if(1===t.length)return t[0].columns.slice();var e={};return t.reduce(function(t,n){return n.columns.forEach(function(n){var r=n.text;void 0===e[r]&&(e[r]=t.length,t.push(n))}),t},[])},transform:function(t,e,n){if(t&&0!==t.length){var o=r.default.findIndex(t,function(t){return"table"!==t.type});if(o>-1)throw{message:"Result of query #"+String.fromCharCode(65+o)+" is not in table format, try using another transform."};f.apply(void 0,[n].concat(t))}}},i.json={description:"JSON Data",getColumns:function(t){if(!t||0===t.length)return[];for(var e={},n=0;n<t.length;n++){var a=t[n];if("docs"===a.type)for(var s=Math.min(a.datapoints.length,100),u=0;u<s;u++){var i=a.datapoints[u],l=(0,o.default)(i,null);for(var f in l)e[f]=!0}}return r.default.map(e,function(t,e){return{text:e,value:e}})},transform:function(t,e,n){for(var a,s,u,i=0,l=e.columns;i<l.length;i++){var f={text:l[i].text};t.length>0&&t[0].filterable&&(f.filterable=!0),n.columns.push(f)}for(0===n.columns.length&&n.columns.push({text:"JSON"}),a=0;a<t.length;a++){var c=t[a];for(s=0;s<c.datapoints.length;s++){var m=c.datapoints[s],p=[];if(r.default.isObject(m)&&e.columns.length>0){var h=(0,o.default)(m,null);for(u=0;u<e.columns.length;u++)p.push(h[e.columns[u].value])}else p.push(JSON.stringify(m));n.rows.push(p)}}}},e.transformers=i,e.transformDataToTable=function(t,e){var n=new s.default;if(!t||0===t.length)return n;var r=i[e.transform];if(!r)throw{message:"Transformer "+e.transform+" not found"};return r.transform(t,e,n),n}},,function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e){t.exports=r},,,,function(t,e,n){"use strict";s.$inject=["$q","uiSegmentSrv"],Object.defineProperty(e,"__esModule",{value:!0}),e.TablePanelEditorCtrl=void 0,e.tablePanelEditor=s;var r=function(t){return t&&t.__esModule?t:{default:t}}(n(0)),o=n(1),a=function(){function t(t,e,n){this.$q=e,this.uiSegmentSrv=n,t.editor=this,this.panelCtrl=t.ctrl,this.panel=this.panelCtrl.panel,this.transformers=o.transformers,this.fontSizes=["80%","90%","100%","110%","120%","130%","150%","160%","180%","200%","220%","250%"],this.addColumnSegment=n.newPlusButton(),this.updateTransformHints()}return t.$inject=["$scope","$q","uiSegmentSrv"],t.prototype.updateTransformHints=function(){switch(this.canSetColumns=!1,this.columnsHelpMessage="",this.panel.transform){case"timeseries_aggregations":case"json":this.canSetColumns=!0;break;case"table":this.columnsHelpMessage="Columns and their order are determined by the data query"}},t.prototype.getColumnOptions=function(){var t=this;if(!this.panelCtrl.dataRaw)return this.$q.when([]);var e=this.transformers[this.panel.transform].getColumns(this.panelCtrl.dataRaw),n=r.default.map(e,function(e){return t.uiSegmentSrv.newSegment({value:e.text})});return this.$q.when(n)},t.prototype.addColumn=function(){var t=o.transformers[this.panel.transform].getColumns(this.panelCtrl.dataRaw),e=r.default.find(t,{text:this.addColumnSegment.value});e&&(this.panel.columns.push(e),this.render());var n=this.uiSegmentSrv.newPlusButton();this.addColumnSegment.html=n.html,this.addColumnSegment.value=n.value},t.prototype.transformChanged=function(){this.panel.columns=[],"timeseries_aggregations"===this.panel.transform&&this.panel.columns.push({text:"Avg",value:"avg"}),this.updateTransformHints(),this.render()},t.prototype.render=function(){this.panelCtrl.render()},t.prototype.removeColumn=function(t){this.panel.columns=r.default.without(this.panel.columns,t),this.panelCtrl.render()},t}();function s(t,e){return{restrict:"E",scope:!0,templateUrl:"public/plugins/tradelab-bidder-table/editor.html",controller:a}}e.TablePanelEditorCtrl=a}])});
//# sourceMappingURL=editor.js.map