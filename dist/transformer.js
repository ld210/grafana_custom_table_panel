define(["lodash","app/core/utils/flatten","app/core/time_series2","app/core/table_model"],function(t,e,n,r){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(e,n){e.exports=t},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.transformDataToTable=e.transformers=void 0,e.mergeTablesIntoModel=f;var r=s(n(0)),o=s(n(3)),u=s(n(4)),a=s(n(5));function s(t){return t&&t.__esModule?t:{default:t}}var i={};function l(t,e,n){for(var r=!1,o=0;o<t.length;o++)if(void 0!==e[o]&&void 0!==n[o]){if(e[o]!==n[o])return!1}else void 0!==e[o]&&void 0!==n[o]||(r=!0);return r}function f(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var o=t||new a.default;if(1===arguments.length)return o;if(2===arguments.length)return o.columns=e[0].hasOwnProperty("columns")?e[0].columns.slice():[],o.rows=e[0].hasOwnProperty("rows")?e[0].rows.slice():[],o;var u={},s=e.slice().reduce(function(t,e){return e.columns.forEach(function(e){var n=e.text;void 0===u[n]&&(u[n]=t.length,t.push(e))}),t},[]),i=e.map(function(t){return t.columns.map(function(t){return u[t.text]})}),f=e.reduce(function(t,e,n){var r=i[n];return e.rows.forEach(function(e){var n=[];r.forEach(function(t,r){n[t]=e[r]}),t.push(n)}),t},[]),c={},m=f.reduce(function(t,e,n){if(!c[n]){for(var o=n+1;o<f.length;){var u=r.default.findIndex(f,function(t){return l(s,e,t)},o);if(!(u>-1))break;for(var a=f[u],i=0;i<s.length;i++)void 0===e[i]&&void 0!==a[i]&&(e[i]=a[i]);c[u]=a,o=u+1}t.push(e)}return t},[]);return o.columns=s,o.rows=m,o}i.timeseries_to_rows={description:"Time series to rows",getColumns:function(){return[]},transform:function(t,e,n){n.columns=[{text:"Time",type:"date"},{text:"Metric"},{text:"Value"}];for(var r=0;r<t.length;r++)for(var o=t[r],u=0;u<o.datapoints.length;u++){var a=o.datapoints[u];n.rows.push([a[1],o.target,a[0]])}}},i.timeseries_to_columns={description:"Time series to columns",getColumns:function(){return[]},transform:function(t,e,n){n.columns.push({text:"Time",type:"date"});for(var r={},o=0;o<t.length;o++){var u=t[o];n.columns.push({text:u.target});for(var a=0;a<u.datapoints.length;a++){var s=u.datapoints[a],i=s[1].toString();r[i]?r[i][o]=s[0]:(r[i]={time:s[1]},r[i][o]=s[0])}}for(var l in r){var f=r[l],c=[f.time];for(o=0;o<t.length;o++){var m=f[o];c.push(m)}n.rows.push(c)}}},i.timeseries_aggregations={description:"Time series aggregations",getColumns:function(){return[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Total",value:"total"},{text:"Current",value:"current"},{text:"Count",value:"count"}]},transform:function(t,e,n){var r,o;for(n.columns.push({text:"Metric"}),r=0;r<e.columns.length;r++)n.columns.push({text:e.columns[r].text});for(r=0;r<t.length;r++){var a=new u.default({datapoints:t[r].datapoints,alias:t[r].target});a.getFlotPairs("connected");var s=[a.alias];for(o=0;o<e.columns.length;o++)s.push(a.stats[e.columns[o].value]);n.rows.push(s)}}},i.annotations={description:"Annotations",getColumns:function(){return[]},transform:function(t,e,n){if(n.columns.push({text:"Time",type:"date"}),n.columns.push({text:"Title"}),n.columns.push({text:"Text"}),n.columns.push({text:"Tags"}),t&&t.annotations&&0!==t.annotations.length)for(var r=0;r<t.annotations.length;r++){var o=t.annotations[r];n.rows.push([o.time,o.title,o.text,o.tags])}}},i.table={description:"Table",getColumns:function(t){if(!t||0===t.length)return[];if(1===t.length)return t[0].columns.slice();var e={};return t.reduce(function(t,n){return n.columns.forEach(function(n){var r=n.text;void 0===e[r]&&(e[r]=t.length,t.push(n))}),t},[])},transform:function(t,e,n){if(t&&0!==t.length){var o=r.default.findIndex(t,function(t){return"table"!==t.type});if(o>-1)throw{message:"Result of query #"+String.fromCharCode(65+o)+" is not in table format, try using another transform."};f.apply(void 0,[n].concat(t))}}},i.json={description:"JSON Data",getColumns:function(t){if(!t||0===t.length)return[];for(var e={},n=0;n<t.length;n++){var u=t[n];if("docs"===u.type)for(var a=Math.min(u.datapoints.length,100),s=0;s<a;s++){var i=u.datapoints[s],l=(0,o.default)(i,null);for(var f in l)e[f]=!0}}return r.default.map(e,function(t,e){return{text:e,value:e}})},transform:function(t,e,n){for(var u,a,s,i=0,l=e.columns;i<l.length;i++){var f={text:l[i].text};t.length>0&&t[0].filterable&&(f.filterable=!0),n.columns.push(f)}for(0===n.columns.length&&n.columns.push({text:"JSON"}),u=0;u<t.length;u++){var c=t[u];for(a=0;a<c.datapoints.length;a++){var m=c.datapoints[a],p=[];if(r.default.isObject(m)&&e.columns.length>0){var d=(0,o.default)(m,null);for(s=0;s<e.columns.length;s++)p.push(d[e.columns[s].value])}else p.push(JSON.stringify(m));n.rows.push(p)}}}},e.transformers=i,e.transformDataToTable=function(t,e){var n=new a.default;if(!t||0===t.length)return n;var r=i[e.transform];if(!r)throw{message:"Transformer "+e.transform+" not found"};return r.transform(t,e,n),n}},,function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e){t.exports=r}])});
//# sourceMappingURL=transformer.js.map